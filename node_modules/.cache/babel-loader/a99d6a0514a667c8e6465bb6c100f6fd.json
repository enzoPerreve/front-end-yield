{"ast":null,"code":"import _slicedToArray from\"/Users/florianc/Documents/PERSO/blockchain/Polyion/polyion-frontend-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/florianc/Documents/PERSO/blockchain/Polyion/polyion-frontend-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/florianc/Documents/PERSO/blockchain/Polyion/polyion-frontend-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import BigNumber from'bignumber.js';import erc20ABI from'config/abi/erc20.json';import masterchefABI from'config/abi/masterchef.json';import multicall from'utils/multicall';import farmsConfig from'config/constants/farms';import{getMasterChefAddress}from'utils/addressHelpers';var CHAIN_ID=process.env.REACT_APP_CHAIN_ID;export var fetchFarmUserAllowances=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(account){var masterChefAdress,calls,rawLpAllowances,parsedLpAllowances;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:masterChefAdress=getMasterChefAddress();calls=farmsConfig.map(function(farm){var lpContractAddress=farm.isTokenOnly?farm.tokenAddresses[CHAIN_ID]:farm.lpAddresses[CHAIN_ID];return{address:lpContractAddress,name:'allowance',params:[account,masterChefAdress]};});_context.next=4;return multicall(erc20ABI,calls);case 4:rawLpAllowances=_context.sent;parsedLpAllowances=rawLpAllowances.map(function(lpBalance){return new BigNumber(lpBalance).toJSON();});return _context.abrupt(\"return\",parsedLpAllowances);case 7:case\"end\":return _context.stop();}}},_callee);}));return function fetchFarmUserAllowances(_x){return _ref.apply(this,arguments);};}();export var fetchFarmUserTokenBalances=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(account){var calls,rawTokenBalances,parsedTokenBalances;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:calls=farmsConfig.map(function(farm){var lpContractAddress=farm.isTokenOnly?farm.tokenAddresses[CHAIN_ID]:farm.lpAddresses[CHAIN_ID];return{address:lpContractAddress,name:'balanceOf',params:[account]};});// const decimalsCalls = farmsConfig.map((farm) => {\n//   const lpContractAddress = farm.isTokenOnly ? farm.tokenAddresses[CHAIN_ID] : farm.lpAddresses[CHAIN_ID];\n//   return {\n//     address: lpContractAddress,\n//     name: 'decimals'\n//   }\n// });\n_context2.next=3;return multicall(erc20ABI,calls);case 3:rawTokenBalances=_context2.sent;// const tokenDecimals = await multicall(erc20ABI, decimalsCalls);\n// const zip = rows => rows[0].map((_, c) => rows.map(row => row[c]));\nparsedTokenBalances=rawTokenBalances.map(function(tokenBalance){return new BigNumber(tokenBalance).toJSON();});return _context2.abrupt(\"return\",parsedTokenBalances);case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchFarmUserTokenBalances(_x2){return _ref2.apply(this,arguments);};}();export var fetchFarmUserStakedBalances=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(account){var masterChefAdress,calls,rawStakedBalances,parsedStakedBalances;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:masterChefAdress=getMasterChefAddress();calls=farmsConfig.map(function(farm){return{address:masterChefAdress,name:'userInfo',params:[farm.pid,account]};});_context3.next=4;return multicall(masterchefABI,calls);case 4:rawStakedBalances=_context3.sent;parsedStakedBalances=rawStakedBalances.map(function(stakedBalance){return new BigNumber(stakedBalance[0]._hex).toJSON();});return _context3.abrupt(\"return\",parsedStakedBalances);case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchFarmUserStakedBalances(_x3){return _ref3.apply(this,arguments);};}();export var fetchFarmUserEarnings=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(account){var masterChefAdress,calls,decimalsCalls,rawEarnings,tokenDecimals,zip,parsedEarnings;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:masterChefAdress=getMasterChefAddress();calls=farmsConfig.map(function(farm){return{address:masterChefAdress,name:'pendingTel',params:[farm.pid,account]};});decimalsCalls=farmsConfig.map(function(farm){var lpContractAddress=farm.isTokenOnly?farm.tokenAddresses[CHAIN_ID]:farm.lpAddresses[CHAIN_ID];return{address:lpContractAddress,name:'decimals'};});_context4.next=5;return multicall(masterchefABI,calls);case 5:rawEarnings=_context4.sent;_context4.next=8;return multicall(erc20ABI,decimalsCalls);case 8:tokenDecimals=_context4.sent;zip=function zip(rows){return rows[0].map(function(_,c){return rows.map(function(row){return row[c];});});};parsedEarnings=zip([rawEarnings,tokenDecimals]).map(function(_ref5){var _ref6=_slicedToArray(_ref5,2),earnings=_ref6[0],decimals=_ref6[1];// console.log(18 -decimals[0])\nreturn new BigNumber(earnings).div(new BigNumber(10).pow(18-decimals[0])).toJSON();});return _context4.abrupt(\"return\",parsedEarnings);case 12:case\"end\":return _context4.stop();}}},_callee4);}));return function fetchFarmUserEarnings(_x4){return _ref4.apply(this,arguments);};}();","map":{"version":3,"sources":["/Users/florianc/Documents/PERSO/blockchain/Polyion/polyion-frontend-master/src/state/farms/fetchFarmUser.ts"],"names":["BigNumber","erc20ABI","masterchefABI","multicall","farmsConfig","getMasterChefAddress","CHAIN_ID","process","env","REACT_APP_CHAIN_ID","fetchFarmUserAllowances","account","masterChefAdress","calls","map","farm","lpContractAddress","isTokenOnly","tokenAddresses","lpAddresses","address","name","params","rawLpAllowances","parsedLpAllowances","lpBalance","toJSON","fetchFarmUserTokenBalances","rawTokenBalances","parsedTokenBalances","tokenBalance","fetchFarmUserStakedBalances","pid","rawStakedBalances","parsedStakedBalances","stakedBalance","_hex","fetchFarmUserEarnings","decimalsCalls","rawEarnings","tokenDecimals","zip","rows","_","c","row","parsedEarnings","earnings","decimals","div","pow"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\nimport erc20ABI from 'config/abi/erc20.json'\nimport masterchefABI from 'config/abi/masterchef.json'\nimport multicall from 'utils/multicall'\nimport farmsConfig from 'config/constants/farms'\nimport { getMasterChefAddress } from 'utils/addressHelpers'\n\nconst CHAIN_ID = process.env.REACT_APP_CHAIN_ID\n\nexport const fetchFarmUserAllowances = async (account: string) => {\n  const masterChefAdress = getMasterChefAddress()\n\n  const calls = farmsConfig.map((farm) => {\n    const lpContractAddress = farm.isTokenOnly ? farm.tokenAddresses[CHAIN_ID] : farm.lpAddresses[CHAIN_ID]\n    return { address: lpContractAddress, name: 'allowance', params: [account, masterChefAdress] }\n  })\n\n  const rawLpAllowances = await multicall(erc20ABI, calls)\n  const parsedLpAllowances = rawLpAllowances.map((lpBalance) => {\n    return new BigNumber(lpBalance).toJSON()\n  })\n  return parsedLpAllowances\n}\n\nexport const fetchFarmUserTokenBalances = async (account: string) => {\n  const calls = farmsConfig.map((farm) => {\n    const lpContractAddress = farm.isTokenOnly ? farm.tokenAddresses[CHAIN_ID] : farm.lpAddresses[CHAIN_ID]\n    return {\n      address: lpContractAddress,\n      name: 'balanceOf',\n      params: [account],\n    }\n  });\n\n  // const decimalsCalls = farmsConfig.map((farm) => {\n  //   const lpContractAddress = farm.isTokenOnly ? farm.tokenAddresses[CHAIN_ID] : farm.lpAddresses[CHAIN_ID];\n  //   return {\n  //     address: lpContractAddress,\n  //     name: 'decimals'\n  //   }\n  // });\n\n  const rawTokenBalances = await multicall(erc20ABI, calls);\n  // const tokenDecimals = await multicall(erc20ABI, decimalsCalls);\n\n  // const zip = rows => rows[0].map((_, c) => rows.map(row => row[c]));\n\n  const parsedTokenBalances = rawTokenBalances.map((tokenBalance) => {\n    return new BigNumber(tokenBalance).toJSON()\n  });\n  \n  return parsedTokenBalances\n}\n\nexport const fetchFarmUserStakedBalances = async (account: string) => {\n  const masterChefAdress = getMasterChefAddress()\n\n  const calls = farmsConfig.map((farm) => {\n    return {\n      address: masterChefAdress,\n      name: 'userInfo',\n      params: [farm.pid, account],\n    }\n  })\n\n  const rawStakedBalances = await multicall(masterchefABI, calls)\n  const parsedStakedBalances = rawStakedBalances.map((stakedBalance) => {\n    return new BigNumber(stakedBalance[0]._hex).toJSON()\n  })\n  return parsedStakedBalances\n}\n\nexport const fetchFarmUserEarnings = async (account: string) => {\n  const masterChefAdress = getMasterChefAddress()\n\n  const calls = farmsConfig.map((farm) => {\n    return {\n      address: masterChefAdress,\n      name: 'pendingTel',\n      params: [farm.pid, account],\n    }\n  })\n\n  const decimalsCalls = farmsConfig.map((farm) => {\n    const lpContractAddress = farm.isTokenOnly ? farm.tokenAddresses[CHAIN_ID] : farm.lpAddresses[CHAIN_ID];\n    return {\n      address: lpContractAddress,\n      name: 'decimals'\n    }\n  });\n\n  const rawEarnings = await multicall(masterchefABI, calls)\n\n  const tokenDecimals = await multicall(erc20ABI, decimalsCalls);\n\n  const zip = rows => rows[0].map((_, c) => rows.map(row => row[c]));\n\n  const parsedEarnings = zip([rawEarnings, tokenDecimals]).map(([earnings, decimals]) => {\n    // console.log(18 -decimals[0])\n    return new BigNumber(earnings).div(new BigNumber(10).pow(18 - decimals[0])).toJSON()\n  })\n  return parsedEarnings\n}\n"]},"metadata":{},"sourceType":"module"}